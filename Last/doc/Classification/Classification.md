# 程式碼說明

處理影像和對應的JSON標註資料，並將其轉換為YOLO格式的標註檔案，最後將資料隨機分配到訓練集、測試集和驗證集中。

## 主要流程

1. **圖像處理與旋轉：**
   - 程式會讀取指定資料夾內的影像檔案，將其裁剪並填充至指定背景大小，然後根據設定的旋轉角度增量將圖像進行旋轉處理。
   
2. **JSON標註處理：**
   - 程式會讀取每個影像檔案對應的JSON標註檔案，將標註資料轉換為YOLO格式（包含標註類別、中心座標、寬度和高度），並將其保存為YOLO標註檔案。

3. **資料集拆分：**
   - 程式會將所有影像及其對應標註檔案隨機拆分為訓練集、測試集和驗證集，並將其複製到指定資料夾中。

## 主要結構與功能

### 1. `YoloAnnotation` 結構
`YoloAnnotation` 用於保存YOLO格式的標註資料，包括：
- `class_id`: 類別 ID
- `x_center`: 物體中心的X座標（相對於影像寬度）
- `y_center`: 物體中心的Y座標（相對於影像高度）
- `width`: 物體的寬度（相對於影像寬度）
- `height`: 物體的高度（相對於影像高度）

### 2. `convertToYoloFormat` 函數
將傳入的JSON標註資料轉換為YOLO格式。此函數會根據影像的寬度和高度來計算物體在影像中的位置和大小，並返回一個`YoloAnnotation`向量。

### 3. `saveYoloAnnotations` 函數
將YOLO格式的標註資料保存到檔案中，每行包含一個標註，格式為：`class_id x_center y_center width height`。

### 4. `randomSplitAndCopy` 函數
此函數會將影像和對應的標註檔案隨機拆分為訓練集、測試集和驗證集，並將它們複製到相應的資料夾中。

### 5. `processImageAndJson` 函數
該函數負責：
- 讀取影像並裁剪為指定大小。
- 生成背景並將裁剪後的影像粘貼到背景上。
- 旋轉影像並保存旋轉後的影像。
- 如果存在對應的JSON檔案，則將其轉換為YOLO格式並保存。

### 6. `processDirectory` 函數
該函數會遍歷指定資料夾中的所有影像檔案，並對每個影像檔案及其對應的JSON標註檔案執行`processImageAndJson`處理。最後，會調用`randomSplitAndCopy`來進行資料集的拆分和複製。

### 7. `main` 函數
程式的入口點，負責處理命令列參數，並調用`processDirectory`來處理指定資料夾中的影像和標註資料。

## 輸入與輸出

### 輸入：
- `input_folder`: 包含原始影像和對應JSON標註檔案的資料夾路徑。
- `output_folder`: 生成的影像和標註資料將被保存的資料夾路徑。
- `yolo_folder`: 用於保存訓練、測試和驗證資料集的資料夾。
- `background_size`: 影像背景的大小。
- `crop_size`: 影像裁剪的大小。
- `rotation_angle_increment`: 旋轉角度的增量，控制每次旋轉的角度。

### 輸出：
- 影像檔案和相應的YOLO格式標註檔案，保存到`output_folder`內，並按旋轉角度命名。
- 資料集會隨機分配為訓練集、測試集和驗證集，並保存至`yolo_folder`中。

## 依賴庫
- `opencv2`: 用於影像處理（讀取影像、裁剪、旋轉、儲存等）。
- `nlohmann/json`: 用於處理JSON格式的標註資料。
- `filesystem`: 用於操作檔案系統，遍歷資料夾、複製檔案等。
- `random`: 用於隨機拆分資料集。

## 結論

這段程式碼提供了一個完整的資料預處理流程，將影像和標註資料轉換為YOLO格式，並隨機拆分為不同的資料集，方便用於機器學習訓練。
